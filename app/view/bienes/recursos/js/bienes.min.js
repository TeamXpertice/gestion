document.addEventListener("DOMContentLoaded",function(){function e(e,t){"success"===e.status?Swal.fire({icon:"success",title:"¡Éxito!",text:t||e.message,confirmButtonText:"Aceptar"}).then(()=>location.reload()):Swal.fire({icon:"error",title:"Error",text:e.message||"Algo salió mal.",confirmButtonText:"Aceptar"})}function t(e,t=null){Swal.fire({icon:"error",title:"Error",text:e,confirmButtonText:"Aceptar"}),t&&console.error("Error:",t)}$("#categoria_bien_id").select2({placeholder:"Seleccione una categoría",allowClear:!0,width:"100%"});const n=document.getElementById("formCrearCategoria");n&&n.addEventListener("submit",function(n){n.preventDefault();const o=new FormData(this);fetch("/gestion/app/controller/CategoriaBienesController.php?action=crearCategoria",{method:"POST",body:o}).then(e=>e.json()).then(t=>e(t,"Categoría creada exitosamente.")).catch(e=>t("Ocurrió un error inesperado. Intenta de nuevo.",e))});const o=document.getElementById("modalEditarBien");o&&document.querySelectorAll('button[data-bs-target="#modalEditarBien"]').forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-id"),t=this.getAttribute("data-descripcion"),n=this.getAttribute("data-proveedor")||"Sin datos",o=this.getAttribute("data-modelo")||"Sin datos",r=this.getAttribute("data-serie_codigo")||"Sin datos",i=this.getAttribute("data-marca")||"Sin datos",a=this.getAttribute("data-estado")||"Sin datos",c=this.getAttribute("data-dimensiones")||"Sin datos",l=this.getAttribute("data-color")||"Sin datos",s=this.getAttribute("data-tipo_material")||"Sin datos",d=this.getAttribute("data-estado_fisico_actual")||"Sin datos",u=this.getAttribute("data-cantidad"),m=this.getAttribute("data-coste")||"Sin datos",g=this.getAttribute("data-observacion")||"Sin datos",h=this.getAttribute("data-categoria_id");document.getElementById("bienId").value=e,document.getElementById("categoria_bien_id").value=h,document.getElementById("descripcion_bien").value=t,document.getElementById("nombre_proveedor").value=n,document.getElementById("modelo").value=o,document.getElementById("serie_codigo").value=r,document.getElementById("marca").value=i,document.getElementById("estado").value=a,document.getElementById("dimensiones").value=c,document.getElementById("color").value=l,document.getElementById("tipo_material").value=s,document.getElementById("estado_fisico_actual").value=d,document.getElementById("cantidad").value=u,document.getElementById("coste").value=m,document.getElementById("observacion").value=g})});const r=document.getElementById("formCrearBien");r&&r.addEventListener("submit",function(e){e.preventDefault();const t=new FormData(this);fetch("/gestion/app/controller/BienController.php?action=crearBien",{method:"POST",body:t}).then(e=>e.json()).then(e=>{"success"===e.status?Swal.fire({icon:"success",title:"¡Éxito!",text:e.message,confirmButtonText:"Aceptar"}).then(()=>{window.location.href="/gestion/app/controller/BienController.php?action=listarBienes"}):Swal.fire({icon:"error",title:"Error",text:e.message,confirmButtonText:"Aceptar"})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Ocurrió un error inesperado. Intenta de nuevo.",confirmButtonText:"Aceptar"}),console.error("Error:",e)})});const i=document.getElementById("formEditarBien");i&&i.addEventListener("submit",function(e){e.preventDefault();const t=new FormData(this);fetch("/gestion/app/controller/BienController.php?action=editarBien",{method:"POST",body:t}).then(e=>e.json()).then(e=>{"success"===e.status?Swal.fire({icon:"success",title:"¡Actualización exitosa!",text:e.message,confirmButtonText:"Aceptar"}).then(()=>location.reload()):Swal.fire({icon:"error",title:"Error",text:e.message,confirmButtonText:"Aceptar"})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Ocurrió un error inesperado. Intenta de nuevo.",confirmButtonText:"Aceptar"}),console.error("Error:",e)})}),window.eliminarBien=function(e){e?Swal.fire({title:"¿Está seguro?",text:"Esta acción eliminará el bien permanentemente.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&fetch("/gestion/app/controller/BienController.php?action=eliminarBien",{method:"POST",body:new URLSearchParams({id:e})}).then(e=>e.json()).then(e=>{"success"===e.status?Swal.fire({icon:"success",title:"¡Eliminado!",text:e.message,confirmButtonText:"Aceptar"}).then(()=>location.reload()):Swal.fire({icon:"error",title:"Error",text:e.message,confirmButtonText:"Aceptar"})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Ocurrió un error inesperado. Intenta de nuevo.",confirmButtonText:"Aceptar"}),console.error("Error:",e)})}):Swal.fire({icon:"error",title:"Error",text:"ID no válido para eliminar el bien.",confirmButtonText:"Aceptar"})}}),$(document).ready(function(){const e=$("#tablaBienes").DataTable({dom:"Bfrtip",buttons:[{extend:"excelHtml5",title:"Listado de Bienes",exportOptions:{columns:":visible:not(:last-child)"}},{extend:"print",title:"Listado de Bienes",exportOptions:{columns:":visible:not(:last-child)"}}],responsive:!0,columnDefs:[{targets:[-1],orderable:!1,searchable:!1},{targets:[2,4,5],visible:!1}],language:{url:"/gestion/public/js/SpanishDataTable1.10.21/Spanish.json"}});$("#toggleColumnFilters").on("change",function(){$("#columnFilters").toggle(this.checked)}),e.columns().every(function(e){const t=this,n=$(t.header()).text();$("#columnFilters").append(`\n            <input type="checkbox" id="filter-column-${e}" class="toggle-column" data-column-index="${e}" ${t.visible()?"checked":""} />\n            <label for="filter-column-${e}">${n}</label>\n        `)}),$("#columnFilters").on("change",".toggle-column",function(){const t=$(this).data("column-index"),n=$(this).is(":checked");e.column(t).visible(n)})});