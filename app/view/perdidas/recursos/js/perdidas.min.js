function agregarProducto(o,t,a){if(o){var r=productosSeleccionados.find(t=>t.id===o);r?r.cantidad+=a:productosSeleccionados.push({id:o,nombre:t,cantidad:a>0?a:0,sinStock:0===a}),actualizarVistaPrevia()}else console.error("ID de producto no especificado")}function actualizarVistaPrevia(){var o=0,t="";productosSeleccionados.length>0?(t='<ul class="list-group">',productosSeleccionados.forEach(function(a){o+=a.cantidad,t+=`<li class="list-group-item">\n                        <div><strong>${a.nombre}</strong> ${a.sinStock?'<span class="text-danger">(Sin stock)</span>':""}</div>\n                        <div><strong>Cantidad:</strong> ${a.cantidad}</div>\n                     </li>`}),t+="</ul>"):t="<p>No hay productos seleccionados.</p>",$("#perdidaPreview").html(t),$("#totalPerdida").html("<h4>Total: "+o+" unidades</h4>"),$("#productosSeleccionados").val(JSON.stringify(productosSeleccionados))}function mostrarConsumiblesPorCategoria(o){$.ajax({url:"/gestion/app/controller/PerdidasController.php",type:"GET",dataType:"json",data:{action:"obtenerConsumiblesPorCategoria",categoria_id:o},success:function(o){var t=o,a='<table class="table table-bordered"><thead><tr><th>Nombre</th><th>Cantidad</th><th>Acci√≥n</th></tr></thead><tbody>';t.forEach(function(o){a+=`<tr>\n                            <td>${o.nombre}</td>\n                            <td>${o.stock}</td>\n                            <td><button type="button" class="btn btn-success" onclick="agregarProducto(${o.id}, '${o.nombre}', ${o.stock})">Agregar</button></td>\n                         </tr>`}),a+="</tbody></table>",$("#consumiblesList").html(a)},error:function(o,t,a){console.error("Error AJAX:",t,a),$("#consumiblesList").html("<p>Error al cargar los consumibles.</p>")}})}var productosSeleccionados=[];